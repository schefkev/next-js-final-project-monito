SCHEMA OLD:
users
sessions
tenants
apartments
requests
tenantsessions
stats

export async function up(sql) {
await sql`
  CREATE TABLE tenants (
    id integer PRIMARY KEY GENERATED ALWAYS AS IDENTITY,
    username varchar(80) NOT NULL UNIQUE,
    password varchar(70) NOT NULL,
    user_id integer REFERENCES users(id) ON DELETE CASCADE,
    avatar text
  )`;
}

export async function down(sql) {
await sql`DROP TABLE tenants`;
}

export async function up(sql) {
await sql`
  CREATE TABLE apartments (
    id integer PRIMARY KEY GENERATED ALWAYS AS IDENTITY,
    user_id integer REFERENCES users(id) ON DELETE CASCADE,
    tenant_id integer REFERENCES tenants(id) ON DELETE CASCADE,
    name varchar(100) NOT NULL,
    address varchar(100) NOT NULL,
    city varchar(70) NOT NULL,
    unit varchar(70) NOT NULL,
    zip varchar(70) NOT NULL,
    rent decimal(10,2) NOT NULL,
    occupied boolean DEFAULT FALSE,
    image TEXT
  )`;
}

export async function down(sql) {
await sql`DROP TABLE apartments`;
}

export async function up(sql) {
await sql`
  CREATE TABLE requests (
    id integer PRIMARY KEY GENERATED ALWAYS AS IDENTITY,
    tenant_id integer REFERENCES tenants(id) ON DELETE CASCADE,
    message text,
    picture text,
    created_at timestamp NOT NULL DEFAULT NOW()
  )`;
}

export async function down(sql) {
await sql`DROP TABLE requests`;
}

export async function up(sql) {
await sql`  CREATE TABLE tenantsessions (
      id integer PRIMARY KEY GENERATED BY DEFAULT AS IDENTITY,
      token varchar(110) NOT NULL UNIQUE,
      expiry_timestamp timestamp NOT NULL DEFAULT NOW() + INTERVAL '24 hours',
			user_id integer REFERENCES tenants (id) ON DELETE CASCADE,
      csrf_secret varchar NOT NULL
  )`;
}

export async function down(sql) {
await sql`  DROP TABLE tenantsessions`;
}

export async function up(sql) {
await sql`
  CREATE TABLE stats (
    id integer PRIMARY KEY GENERATED ALWAYS AS IDENTITY,
    user_id integer REFERENCES users(id) ON DELETE CASCADE,
    apartment_id integer REFERENCES apartments(id) ON DELETE CASCADE,
    rent decimal(10,2) NOT NULL,
    mortgage decimal(10,2),
    expense decimal(10,2),
    month varchar(20),
    year varchar(20)
  )`;
}

export async function down(sql) {
await sql`DROP TABLE stats`;
}
